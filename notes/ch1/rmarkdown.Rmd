# R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Including Plots

插入图像

```{r lena,fig.cap="lena", echo=FALSE,small.mar = TRUE,out.width="45%",fig.asp=1}
library(png)
library(jpeg)
library(bmp)
library(IM)
# create an object of class "Image"
data(lena)
obj = new("Image",img=img)
# display image
displayImg(obj@I)
```

分组散点图添加平滑线和回归线

```{r scatter-iris, echo=FALSE,fig.cap="线性回归模型",out.width="45%",fig.asp=1}
library(car)
scatterplot(Sepal.Length ~ Sepal.Width, col = c("black","red","blue"), pch=c(16,16,16),
            smooth = TRUE, boxplots = "xy", groups = iris$Species, 
            xlab = "Sepal.Width", ylab = "Sepal.Length", data = iris
)
```

插入 TikZ 制作的图形，一行两列

```{r linear-model,dev='tikz',fig.cap="线性回归模型",echo=FALSE,fig.pos="!htb",out.width="35%",fig.show='hold',fig.asp=1,fig.width=3.5}
# 带有图标题
par(mar = c(4.1, 4.1, 4.5, 1.5), ps = 13, family = "Times")
x <- rnorm(10)
y <- x + rnorm(5, sd = 0.25)
model <- lm(y ~ x)
rsq <- summary(model)$r.squared
rsq <- signif(rsq, 4)
plot(x, y, main = "Hello \\LaTeX!", xlab = "$x$", ylab = "$y$")
abline(model, col = "red")
mtext(paste("Linear model: $R^{2}=", rsq, "$"), line = 0.5)
legend("bottomright", legend = paste("$y = ", round(coef(model)[2], 3),
  "x +", round(coef(model)[1], 3), "$",
  sep = ""
), bty = "n")

plot(x, y, main = "Hello \\LaTeX!", xlab = "$x$", ylab = "$y$")
abline(model, col = "red")
mtext(paste("Linear model: $R^{2}=", rsq, "$"), line = 0.5)
legend("bottomright", legend = paste("$y = ", round(coef(model)[2], 3),
  "x +", round(coef(model)[1], 3), "$",
  sep = ""
), bty = "n")
```

```{r bessel-function,dev='tikz',fig.cap="贝塞尔函数",echo=FALSE,fig.pos="!htb",out.width="35%",fig.show='hold',fig.asp=1,fig.width=2.5}
x0 <- 2^(-20:10)
nus <- c(0:5, 10, 20)
x <- seq(0, 4, length.out = 501)

plot(x0, x0^-8,frame.plot=TRUE,
     log = "xy", xlab = "$u$", axes = FALSE,
     ylab = "$\\mathcal{K}_{\\kappa}(u)$", 
     type = "n", ann = TRUE, panel.first = grid()
) # x 和 y 轴都取对数

axis(1,
     at = c(1e-08, 1e-06, 1e-04, 1e-02, 1, 1e+02),
     labels = expression(10^-8, 10^-6, 10^-4, 10^-2, 1, 10^2)
)
axis(2,
     at = c(1e-16, 1, 1e+16, 1e+32, 1e+48),
     labels = expression(10^-16, 1, 10^16, 10^32, 10^48), las = 1
)
# 设置线条颜色
cols <- RColorBrewer::brewer.pal(9,name = "Spectral")
# gray.colors(9) terrain.colors(9)  RColorBrewer::brewer.pal(9,name = "Spectral")
for (i in seq(length(nus)))
  lines(x0, besselK(x0, nu = nus[i]), col = cols[i], lwd = 2)
legend("topright",legend = paste0("$\\kappa=", rev(nus),"$"),
       col = rev(cols), lwd = 2, cex = 0.5)

# 数据变化范围太大，因此横纵坐标轴都取了以10为底的对数，数据可以紧凑的在一张图内展示
x <- seq(0, 40, length.out = 801)
x <- x[x > 0]
plot(x, x,frame.plot=TRUE,
     ylim = c(1e-18, 1e11), log = "y", xlab = "$u$", type = "n",  yaxt = "n",
     ylab = "$\\mathcal{K}_{\\kappa}(u)$", ann = TRUE, panel.first = grid()
)
axis(2,
     at = c(1e-19, 1e-12, 1e-05, 1e+02, 1e+09),
     labels = expression(10^-19, 10^-12, 10^-5, 10^2, 10^9), las = 1
)

for (i in seq(length(nus)))
  lines(x, besselK(x, nu = nus[i]), col = cols[i], lwd = 2)
legend("topright", legend = paste0("$\\kappa=", rev(nus),"$"), 
       col = rev(cols), lwd = 2, cex = 0.5)
```

