\cleardoublepage 

# (APPENDIX) 附录 {-}

# 软件工具 {#softwares}

Pandoc 和 Markdown

# 概率编程 {#probabilistic-programming-language}

概率编程语言，图模型，贝叶斯推断，马尔科夫链蒙特卡罗，汉密尔顿蒙特卡罗，随机模拟，抽样分布，贝叶斯定理，先验后验

## Stan 简介 {#intro-stan}

何为 Stan [@Stan2018] RStan [@R-rstan] 是 Stan 的 R 语言接口

设置参数

```{r stan-setup,message=FALSE,eval=FALSE}
Sys.setenv(USE_CXX14 = 1)
library("rstan") # observe startup messages
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores()/2)
```

准备数据

```{r load-data}
schools_dat <- list(J = 8, 
                    y = c(28,  8, -3,  7, -1,  1, 18, 12),
                    sigma = c(15, 10, 16, 11,  9, 11, 10, 18))
```

编译运行模型

```{r compile-run,message=FALSE,warning=FALSE}
system.time({
  fit <- stan(
    file = "code/stan/8schools.stan", data = schools_dat,
    iter = 1000, chains = 4
  )
}, gcFirst = TRUE)
```

输出结果

```{r stan-output}
print(fit,digits = 1)
```

参数的后验均值估计 (means) 蒙特卡罗标准误差 (se\_mean) 后验均值估计的标准偏差 (sd) 参数后验分布的五个分位点 $\hat{R}$ (the potential scale reduction derived from all chains after splitting each chain in half and treating the halves as chains) 和有效样本量 (n\_eff)


[结合实际数据详细解释这些个统计量的含义]{.todo}

诊断收敛性

```{r report}
check_hmc_diagnostics(fit)
```

```{r check-model,fig.cap="后验分布的散点矩阵图",out.width="35%",fig.show='hold',fig.asp=1,fig.width=4.5,fig.subcap=c("原始值","取对数")}
pairs(fit, pars = c("mu", "tau", "lp__"))
pairs(fit, pars = c("mu", "tau", "lp__"), log = TRUE)
```

[NUTS 采样器和 HMC 算法的参数设置]{.todo}

[诊断 Stan 的拟合结果]{.todo}

检测收敛性的一系列指标的图示 shinystan

[Stan 内置的优化器 optimizing]{.todo}




---

高斯过程，特别是空间广义线性混合效应模型

变分推断

市面上 WinBUGS/OpenBUGS/JAGS/INLA/MultiBUGS/BayesX/nimble 比较，一般的广义线性混合效应模型

空间广义线性混合效应模型 <https://github.com/XiangyunHuang/notesdown/issues/67>




