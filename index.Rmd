--- 
title: "空间数据分析与建模"
subtitle: "GeoSpatial Data Visualization, Analysis and Modeling in R"
author: "黄湘云"
date: "2018年10月26日"
site: bookdown::bookdown_site
documentclass: book
lof: yes
lot: yes
fontsize: 11pt
bibliography: [latex/book.bib, latex/packages.bib, latex/articles.bib]
biblio-style: apalike
link-citations: yes
description: "GeoSpatial Data Visualization with ggplot2 and Analysis with rstan in R."
url: 'https\://bookdown.org/xiangyun/geospatial/'
github-repo: XiangyunHuang/GeoSpatial-Book
#cover-image: images/cover.png
---


```{r setup,include=FALSE}
library(methods)
set.seed(2018)
# 加载依赖
library(ggplot2)
library(StanHeaders)
library(rstan)
# 设置环境
Sys.setenv(USE_CXX14 = 1)
is_on_travis = identical(Sys.getenv("TRAVIS"), "true")
is_online = curl::has_internet()

options(mc.cores = if(is_on_travis) 4 else 2)
rstan_options(auto_write = TRUE)

# library(tibble)
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  echo = TRUE,
  cache = TRUE,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618
)

doc_type <- function() knitr::opts_knit$get('rmarkdown.pandoc.to')

knitr::knit_hooks$set(
  optipng = knitr::hook_optipng,
  pdfcrop = knitr::hook_pdfcrop,
  small.mar = function(before, options, envir) {
    if (before) par(mar = c(4.1, 4.1, 0.5, 0.5))  # smaller margin on top and right
  }
)
# https://github.com/yihui/knitr-examples/blob/master/085-pdfcrop.Rnw

options(
  digits = 3,
  citation.bibtex.max = 999,
  bitmapType = "cairo",
  stringsAsFactors = FALSE,
  repos = "https://mirrors.tuna.tsinghua.edu.cn/CRAN/",
  knitr.graphics.auto_pdf = FALSE,
  tikzDefaultEngine = "xetex",
  tikzXelatexPackages = c(
    getOption("tikzXelatexPackages"),
    "\\usepackage[colorlinks, breaklinks]{hyperref}",
    "\\usepackage{color,tikz}",
    "\\usepackage[active,tightpage,xetex]{preview}",
    "\\PreviewEnvironment{pgfpicture}",
    "\\usepackage{amsmath,amsfonts,mathrsfs}"
  )
)
```
```{r engine='bash', eval=!is_on_travis & .Platform$OS.type == "unix",include=FALSE}
# 只在本地 CentOS 系统上运行
source /opt/rh/devtoolset-7/enable
```

\mainmatter

# 前言 {#preface .unnumbered}
\chaptermark{前言}
\index{TinyTeX}

This is a _sample_ book written in **Markdown**. You can use anything that Pandoc's Markdown supports, e.g., a math equation $a^2 + b^2 = c^2$.

The **bookdown** package can be installed from CRAN or Github:

```{r eval=FALSE}
install.packages("bookdown")
# or the development version
# devtools::install_github("rstudio/bookdown")
```

Remember each Rmd file contains one and only one chapter, and a chapter is defined by the first-level heading `#`.

To compile this example to PDF, you need XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): <https://yihui.name/tinytex/>.

# 介绍 {#introduction}

## 约定 {#colophon}

这本书在 RStudio 里用 bookdown 写作。网站托管在 Netlify 上，Github 的每次提交都会触发 Travis-ci 重新编译源码书稿，编译成功后，自动推送到 Netlify 上，网站会随之更新。书籍的源代码存放在 Github 上。书中显示代码的字体是 [Source Code Pro](https://github.com/silkeh/latex-sourcecodepro) 

```{r}
devtools::session_info('rstan')
```

```{r, include = FALSE}
ruler <- function(width = getOption("width")) {
  x <- seq_len(width)
  y <- dplyr::case_when(
    x %% 10 == 0 ~ as.character((x %/% 10) %% 10),
    x %% 5 == 0  ~ "+",
    TRUE         ~ "-"
  )
  cat(y, "\n", sep = "")
  cat(x %% 10, "\n", sep = "")
}
```

```{r}
ruler()
```

```{r include=FALSE,cache=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(),'rstan'
), 'latex/packages.bib')
```

